
# TODOアプリケーション 全体仕様

本仕様は、フロントエンド設計のサンプルとして
**状態管理・順序・フィルタ・URL共有・意味的操作**を含む
TODOアプリケーションを定義するものである。

---

## 1. 表示構造

### セクション分離（常に適用）

Todo一覧は、以下の2セクションに分かれて表示される。

1. **期限ありセクション**

   * `dueAt` が存在する Todo
2. **期限なしセクション**

   * `dueAt` が存在しない Todo

※ この分離は `sort=manual` の場合も維持される。

---

## 2. manual 並び順（ドラッグ & ドロップ）

### 基本方針

* Todoは **ユーザー操作により手動で並び替え可能**
* D&Dの対象は **Todo単体のみ**
* 並び替えは **永続化される**
* D&Dは `sort=manual` のときのみ有効

---

## 3. フィルタ中の並び替え仕様（重要）

### 前提

* 全体順序 `S` が存在する
* フィルタによって、`S` の部分列 `V` が可視状態になる

### 操作

* フィルタ適用中に、`V` 上で D&D が行われ、順序が `V'` に変化する

### 全体順序への反映ルール

全体順序 `S'` は、次の条件を満たすように構成される。

1. `V'` に含まれる Todo 同士の相対順序は、`S'` においても必ず保持される
2. フィルタで不可視な Todo 同士の相対順序は、元の `S` を保持する
3. 可視・不可視間の相対順序は、**推論できない場合は元の順序を維持する**

### 具体例

```
全体順序: A, B, C, D, E, F
可視要素: A, D, F

フィルタ中での並び替え:
A, D, F → A, F, D

結果の全体順序:
A, B, C, F, D, E
```

---

## 4. 期限変更時の並び順ルール

### 期限なし → 期限あり

* **期限ありセクションの先頭**に挿入される

### 期限あり → 期限なし

* **期限なしセクションの末尾**に挿入される

※ セクションごとに manual order は独立管理される。

---

## 5. 削除とゴミ箱（Trash）

### 削除操作

* Todoの削除は **即時削除ではなく論理削除**
* 削除時に `archivedAt` を現在時刻で設定する

### ゴミ箱の仕様

* ゴミ箱内のTodoも **検索・フィルタ・ソート可能**
* ゴミ箱は通常ビューとは別の `view=trash` として扱う

### 完全削除

* 自動完全削除は **サーバー側で実行される想定**
* フロントエンドでは対応しない（サンプルスコープ外）

---

## 6. URLクエリ仕様（状態共有）

### 基本方針

* フィルタ・検索・ソート条件は **すべてURLで表現される**
* 同一URLは、同一状態を再現できる

---

### クエリ一覧

| key        | 内容         |            |          |           |
| ---------- | ---------- | ---------- | -------- | --------- |
| `q`        | 検索語        |            |          |           |
| `tags`     | タグ（カンマ区切り） |            |          |           |
| `priority` | `high      | medium     | low      | none`     |
| `status`   | `active    | completed` |          |           |
| `view`     | `inbox     | project    | trash` 等 |           |
| `sort`     | `manual    | createdAt  | dueAt    | priority` |
| `due`      | 期限条件（後述）   |            |          |           |

---

## 7. due クエリの評価ルール

### サポート形式

#### 上限指定（<=）

```
due=~2026-01-14
```

* 意味：`dueAt <= 2026-01-14`

#### 完全一致（==）

```
due=2026-01-14
```

* 意味：`dueAt == 2026-01-14`

### 非サポート

* `<` 単独指定
* 範囲指定（from/to）

### 補足

* `dueAt` 未設定の Todo は、`due` 指定時は常に除外される

---

## 8. sort と manual の関係

* `sort=manual` のときのみ D&D 有効
* `sort != manual` のとき、D&D は無効化される

---

## 9. 優先度の扱い

### 表示・ソート順

```
high > medium > low > none
```

* `priority` 未設定は `none` として扱う
* `none` は `low` よりも低い優先度カテゴリ

---

## 10. 非目的（スコープ外）

本サンプルでは以下を扱わない。

* 自動完全削除の実装
* ユーザー認証
* 権限管理
* 複数端末間の競合解決UI

---

## 付記

本仕様は、
「フィルタされた局所操作が、全体状態へどのように反映されるか」
を明示的に扱うことを目的とした **フロントエンド設計教材**である。
